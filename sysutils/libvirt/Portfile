# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

# NOTE: When you update this port, please also update the following
# language-binding ports: p5-sys-virt

PortSystem          1.0

name                libvirt
version             2.4.0
categories          sysutils
license             LGPL-2.1+
platforms           darwin
maintainers         {ryandesign @ryandesign} openmaintainer

description         Libvirt - The Virtualization API

long_description    A toolkit to interact with the virtualization \
                    capabilities of modern hypervisors.

homepage            https://libvirt.org/
master_sites        ${homepage}sources/
use_xz              yes

checksums           rmd160  ceac4c29e03f7c29113e9a926adb21c6a72cdada \
                    sha256  b727c5f43ed3d7337ec2c2f2031ebd4207507978f68d00ad13d4f0f84aad6224 \
                    size    13237652

depends_build       port:pkgconfig \
                    port:xhtml1

depends_lib         port:curl \
                    port:gnutls \
                    port:libiconv \
                    port:libssh2 \
                    port:libxml2 \
                    port:readline \
                    port:yajl \
                    port:zlib

configure.args      --disable-silent-rules \
                    --without-apparmor \
                    --without-attr \
                    --without-audit \
                    --without-avahi \
                    --without-blkid \
                    --without-capng \
                    --without-dbus \
                    --without-dtrace \
                    --without-fuse \
                    --without-glusterfs \
                    --without-hal \
                    --with-init-script=none \
                    --without-libpcap \
                    --without-lxc \
                    --without-macvtap \
                    --without-netcf \
                    --without-network \
                    --without-numactl \
                    --without-openvz \
                    --without-phyp \
                    --without-polkit \
                    --without-qemu \
                    --without-sasl \
                    --without-selinux \
                    --without-udev \
                    --without-uml \
                    --without-virtualport \
                    --without-xen \
                    --without-xenapi \
                    --without-xen-inotify \
                    --with-esx \
                    --with-libvirtd \
                    --with-remote \
                    --with-test \
                    --with-vbox=check \
                    --with-vmware \
                    --with-xml-catalog-file=${prefix}/etc/xml/catalog \
                    --with-yajl

variant avahi description {Use Avahi to advertise remote daemon} {
    depends_lib-append      port:avahi
    configure.args-replace  --without-avahi --with-avahi
}

variant fuse description {FUSE support} {
    depends_lib-append      port:osxfuse
    configure.args-replace  --without-fuse --with-fuse
}

variant openssl description {Use OpenSSL/LibreSSL instead of GNUTLS} {
    depends_lib-replace     port:gnutls path:lib/libssl.dylib:openssl
    configure.args-append   --without-gnutls --with-openssl
}

variant qemu description {Support managing QEMU VMs} {
    depends_lib-append      port:qemu
    configure.args-replace  --without-qemu --with-qemu
}

variant sasl description {Use Cyrus SASL for authentication} {
    depends_lib-append      port:cyrus-sasl2
    configure.args-replace  --without-sasl --with-sasl
}

livecheck.type      regex
livecheck.url       [lindex ${master_sites} 0]
livecheck.regex     ${name}-(\[0-9.\]+)\\.tar
